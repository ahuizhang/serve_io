{"version":3,"sources":["Home.js","static/image/leftAvatar.jfif","static/image/rightAvatar.jpg","ChatRoom.js","App.js","index.js"],"names":["Home","TabPane","Tabs","useState","isLogin","setIsLogin","className","defaultActiveKey","onChange","key","tab","From","props","history","useHistory","labelCol","span","name","onFinish","values","axios","post","then","res","data","code","message","success","msg","localStorage","setItem","uid","push","catch","err","error","password","confirmPassword","username","Item","label","rules","required","Password","type","htmlType","block","defaults","baseURL","socket","io","ChatRoom","UserList","Chat","userList","setUserList","id","getItem","otherID","setOtherID","useEffect","a","get","response","fetchData","length","itemLayout","dataSource","renderItem","item","_id","onClick","style","background","Meta","avatar","src","title","description","chatList","setChatList","text","setText","filterArr","magsList","filter","chatID","on","map","from","leftAvatar","alt","content","rightAvatar","trim","info","emit","to","placeholder","value","e","target","App","path","exact","component","ReactDOM","render","Fragment","document","getElementById"],"mappings":"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","file":"static/js/main.69550099.chunk.js","sourcesContent":["import { useState } from 'react';\r\nimport { Form, Input, Button, Tabs, message } from 'antd';\r\nimport { useHistory } from \"react-router-dom\";\r\nimport axios from 'axios'\r\naxios.defaults.baseURL = \"http://180.188.198.117:3001\"\r\nexport default function Home() {\r\n    const { TabPane } = Tabs;\r\n    const [isLogin, setIsLogin] = useState(true)\r\n    const callback = (key) => {\r\n        switch (key) {\r\n            case \"1\":\r\n                setIsLogin(true)\r\n                break;\r\n            case \"2\":\r\n                setIsLogin(false)\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    return (\r\n        <div className=\"badyHome\">\r\n            <div className=\"login_container\">\r\n                <Tabs defaultActiveKey=\"1\" onChange={callback}>\r\n                    <TabPane tab=\"登入\" key=\"1\">\r\n                        <From isLogin={isLogin} />\r\n                    </TabPane>\r\n                    <TabPane tab=\"注册\" key=\"2\">\r\n                        <From isLogin={isLogin} />\r\n                    </TabPane>\r\n                </Tabs>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction From(props) {\r\n    const history = useHistory();\r\n    const layout = {\r\n        labelCol: { span: 6 },\r\n    };\r\n    const onFinish = (values) => {\r\n        if (props.isLogin) {\r\n            axios.post('/user/login', values)\r\n                .then(res => {\r\n                    if (res.data && res.data.code === 0) {\r\n                        message.success(res.data.msg);\r\n                        localStorage.setItem('id', res.data.uid)\r\n                        history.push('/chatroom')\r\n                    } else {\r\n                        message.success(res.data.msg);\r\n                    }\r\n                })\r\n                .catch(err => {\r\n                    message.error(err);\r\n                })\r\n        } else {\r\n            if (values.password !== values.confirmPassword) return\r\n            axios.post('/user/register', { username: values.username, password: values.password })\r\n                .then(res => {\r\n                    if (res.data && res.data.code === 0) {\r\n                        message.success(res.data.msg);\r\n                        localStorage.setItem('id', res.data.uid)\r\n                        history.push('/chatroom')\r\n                    } else {\r\n                        message.success(res.data.msg);\r\n                    }\r\n                })\r\n                .catch(err => {\r\n                    message.error(err);\r\n                })\r\n        }\r\n    };\r\n    return (\r\n        <Form\r\n            {...layout}\r\n            name=\"login\"\r\n            onFinish={onFinish}\r\n        >\r\n            <Form.Item\r\n                label=\"账号\"\r\n                name=\"username\"\r\n                rules={[\r\n                    {\r\n                        required: true,\r\n                        message: '请输入账号!',\r\n                    },\r\n                ]}\r\n            >\r\n                <Input />\r\n            </Form.Item>\r\n            <Form.Item\r\n                label=\"密码\"\r\n                name=\"password\"\r\n                rules={[\r\n                    {\r\n                        required: true,\r\n                        message: '请输入密码!',\r\n                    },\r\n                ]}\r\n            >\r\n                <Input.Password />\r\n            </Form.Item>\r\n            {\r\n                !props.isLogin ?\r\n                    <Form.Item\r\n                        label=\"确认密码\"\r\n                        name=\"confirmPassword\"\r\n                        rules={[\r\n                            {\r\n                                required: true,\r\n                                message: '请输入确认密码!',\r\n                            },\r\n                        ]}\r\n                    >\r\n                        <Input.Password />\r\n                    </Form.Item>\r\n                    : null\r\n            }\r\n            <Form.Item >\r\n                <Button type=\"primary\" htmlType=\"submit\" block>{props.isLogin ? \"登入\" : \"注册\"}</Button>\r\n            </Form.Item>\r\n        </Form>\r\n    )\r\n}","export default __webpack_public_path__ + \"static/media/leftAvatar.690ea669.jfif\";","export default __webpack_public_path__ + \"static/media/rightAvatar.708ac5b1.jpg\";","import { useState, useEffect, useRef } from 'react';\r\nimport './ChatRoom.css'\r\nimport io from \"socket.io-client\";\r\nimport { List, Avatar, Button, Input, message } from 'antd';\r\nimport axios from 'axios'\r\nimport leftAvatar from './static/image/leftAvatar.jfif';\r\nimport rightAvatar from './static/image/rightAvatar.jpg';\r\naxios.defaults.baseURL = \"http://180.188.198.117:3001\"\r\nconst socket = io()\r\nexport default function ChatRoom() {\r\n    return (\r\n        <div className=\"chatRoomContailter\">\r\n            <UserList />\r\n            <Chat />\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction UserList() {\r\n    const [userList, setUserList] = useState([])\r\n    const id = localStorage.getItem('id')\r\n    const [otherID, setOtherID] = useState(localStorage.getItem('otherID'))\r\n    useEffect(() => {\r\n        async function fetchData() {\r\n            const response = await axios.get('/user/list')\r\n            setUserList(response.data.userList)\r\n        }\r\n        fetchData()\r\n    }, [])\r\n    const handleUserClick = (_id) => {\r\n        localStorage.setItem(\"otherID\", _id)\r\n        setOtherID(_id)\r\n    }\r\n    return (\r\n        <div className=\"userList\">\r\n            {userList.length > 0 && <List\r\n                itemLayout=\"horizontal\"\r\n                dataSource={userList}\r\n                renderItem={item => {\r\n                    if (id !== item._id) {\r\n                        return (\r\n                            <List.Item onClick={() => handleUserClick(item._id)} style={{ background: otherID === item._id ? \"aqua\" : \"#fff\" }}>\r\n                                <List.Item.Meta\r\n                                    avatar={<Avatar src=\"https://zos.alipayobjects.com/rmsportal/ODTLcjxAfvqbxHnVXCYX.png\" />}\r\n                                    title={item.username}\r\n                                    description=\"个性签名\"\r\n                                />\r\n                            </List.Item>\r\n                        )\r\n                    }\r\n                }}\r\n            />\r\n            }\r\n        </div>\r\n    )\r\n}\r\nfunction Chat() {\r\n    // const chatContentEl = useRef(null);\r\n    const [chatList, setChatList] = useState([])\r\n    const [text, setText] = useState(\"\")\r\n    const otherID = localStorage.getItem('otherID')\r\n    const id = localStorage.getItem('id')\r\n    useEffect(() => {\r\n        async function fetchData() {\r\n            const response = await axios.get('/user/getMagsList')\r\n            let filterArr = response.data.magsList.filter(item => (item.chatID === otherID + \"_\" + id))\r\n            setChatList(filterArr)\r\n        }\r\n        fetchData()\r\n    }, [id, otherID])\r\n    useEffect(() => {\r\n        socket.on('globalMsg', (data) => {\r\n            setChatList([...chatList, data])\r\n        })\r\n    })\r\n    const sendMsg = () => {\r\n        if (text.trim() === \"\") return message.info(\"内容空\")\r\n        socket.emit('sendMsg', {\r\n            msg: text,\r\n            to: otherID,\r\n            from: id\r\n        })\r\n        setText('')\r\n        // if (chatContentEl.current.scrollHeight > chatContentEl.current.clientHeight) {\r\n        //     setTimeout(() => {\r\n        //         chatContentEl.current.scrollTop = chatContentEl.current.scrollHeight\r\n        //     }, 800)\r\n        // }\r\n    }\r\n    const handleMsg = (e) => {\r\n        if (!e.target.value) return\r\n        setText(e.target.value)\r\n    }\r\n    return (\r\n        otherID && <div className=\"chatRightList\">\r\n            <div className=\"chatContent\">\r\n                {chatList.length > 0 && chatList.map((item => {\r\n                    if (item.from !== id) {\r\n                        return (\r\n                            <div className=\"chatLeft\" key={item._id}>\r\n                                <img src={leftAvatar} alt=\"\" />\r\n                                <div className=\"leftText\">\r\n                                    <span className=\"leftTitle\">tom</span>\r\n                                    <span className=\"leftTx\">{item.content}</span>\r\n                                </div>\r\n                            </div>\r\n                        )\r\n                    } else {\r\n                        return (\r\n                            <div className=\"chatRight\" key={item._id}>\r\n                                <img src={rightAvatar} alt=\"\" />\r\n                                <div className=\"rightText\">\r\n                                    <span className=\"rightTitle\">terr</span>\r\n                                    <span className=\"RightText\">{item.content}</span>\r\n                                </div>\r\n                            </div>\r\n                        )\r\n                    }\r\n                }\r\n                ))\r\n                }\r\n            </div>\r\n            <div className=\"chatRoomFooter\">\r\n                <Button type=\"primary\" className=\"chatSendButton\" onClick={sendMsg}>发送</Button>\r\n                <Input className=\"chatSendContent\" placeholder=\"请输入内容......\" value={text} onChange={handleMsg} />\r\n            </div>\r\n        </div>\r\n    )\r\n}","import './App.css'\nimport { BrowserRouter as Router, Switch, Route } from \"react-router-dom\";\nimport Home from './Home'\nimport ChatRoom from './ChatRoom'\nexport default function App() {\n  return (\n    <Router>\n      <Switch>\n        <Route path=\"/\" exact component={Home} />\n        <Route path=\"/chatroom\" component={ChatRoom} />\n      </Switch>\n    </Router>\n  );\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(\n  <React.Fragment>\n    <App />\n  </React.Fragment>,\n  document.getElementById('root')\n);"],"sourceRoot":""}